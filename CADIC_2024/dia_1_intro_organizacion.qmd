---
title: | 
  | Programaci√≥n y an√°lisis estad√≠stico en R
subtitle: "Introducci√≥n al lenguaje de R y organizaci√≥n del trabajo en Git y GitHub"
author: 
  - name: Ver√≥nica Cruz-Alonso 
    role: Profesora y autora del material
  - name: Julen Astigarraga
    role: Autor del material
date: today
date-format: "DD/MM/YYYY"
toc: true
toc-depth: 4
toc-title: "√çndice"
format:
  html:
    link-external-newwindow: true
    # css: styles.css
  gfm: default
editor: visual
editor_options: 
  chunk_output_type: console
number-sections: true
---

## Qui√©nes somos

Ver√≥nica Cruz-Alonso (veronica.cral\@gmail.com). Investigadora postdoctoral de la Universidad Complutense de Madrid y la Universidad de Alcal√° en Espa√±a.

Imparto cursos de ciencia de datos junto con Julen Astigarraga y Enrique Andivia. En [DatSciR](https://github.com/DatSciR) publicamos los materiales de los cursos que impartimos.

Soy co-coordinadora del [grupo de trabajo de Ecoinform√°tica](https://ecoinfaeet.github.io/website/) de la Asociaci√≥n Espa√±ola de Ecolog√≠a Terrestre.

Y vosotros ¬øqui√©nes sois?

<https://www.menti.com/als6tisi5e3g>

## Presentaci√≥n

En este curso exploraremos tanto los fundamentos te√≥ricos como las aplicaciones pr√°cticas de la ciencia de datos en R. Abordaremos desde tareas comunes con las que nos enfrentamos en nuestro d√≠a a d√≠a, como la limpieza y transformaci√≥n de datos, hasta nociones m√°s avanzadas de visualizaci√≥n y programaci√≥n y an√°lisis estad√≠stico. Adem√°s, aprenderemos a utilizar herramientas para generar documentos reproducibles y colaborativos. El curso combina la teor√≠a con la pr√°ctica y las lecciones se adaptar√°n a los problemas espec√≠ficos de los estudiantes, que ir√°n evolucionando d√≠a a d√≠a.

El objetivo principal es que tanto aquellos con conocimientos b√°sicos en ciencia de datos y an√°lisis estad√≠stico como aquellos con un nivel m√°s avanzado puedan beneficiarse y llevar consigo nuevos aprendizajes al finalizar el curso.

![Modelo de ciencia de datos de Hadley Wickham, Mine √áetinkaya-Rundel y Garrett Grolemund. Traducido de https://r4ds.hadley.nz/intro#fig-ds-diagram](images/datascience.png){#fig-datascience}

## Estructura del curso

+--------------------------------------------------------------------------+--------------------------------------------------------------------+
| Bloques                                                                  | Contenido                                                          |
+==========================================================================+====================================================================+
| Introducci√≥n al lenguaje de R y organizaci√≥n del trabajo en Git y GitHub | Introducci√≥n a la programaci√≥n en R                                |
|                                                                          |                                                                    |
|                                                                          | Introducci√≥n a Git                                                 |
|                                                                          |                                                                    |
|                                                                          | Introducci√≥n a GitHub                                              |
|                                                                          |                                                                    |
|                                                                          | Flujo de trabajo en Git y GitHub                                   |
|                                                                          |                                                                    |
|                                                                          | Trabajos colaborativos                                             |
+--------------------------------------------------------------------------+--------------------------------------------------------------------+
| Organizaci√≥n de datos y bases de programaci√≥n funcional                  | Tidyverse                                                          |
|                                                                          |                                                                    |
|                                                                          | Importar, filtrar, seleccionar, transformar, unir y exportar datos |
|                                                                          |                                                                    |
|                                                                          | Funciones                                                          |
|                                                                          |                                                                    |
|                                                                          | Estilo de c√≥digo                                                   |
|                                                                          |                                                                    |
|                                                                          | Iteraciones                                                        |
|                                                                          |                                                                    |
|                                                                          | Programaci√≥n funcional                                             |
+--------------------------------------------------------------------------+--------------------------------------------------------------------+
| Visualizaci√≥n y an√°lisis exploratorio de datos                           | Fundamentos de visualizaci√≥n                                       |
|                                                                          |                                                                    |
|                                                                          | Bases: gr√°ficos por capas                                          |
|                                                                          |                                                                    |
|                                                                          | Visualizaci√≥n avanzada                                             |
+--------------------------------------------------------------------------+--------------------------------------------------------------------+
| An√°lisis de datos: modelos lineales habituales en ecolog√≠a               |                                                                    |
+--------------------------------------------------------------------------+--------------------------------------------------------------------+
| Comunicaci√≥n de resultados en Quarto                                     | Introducci√≥n a R Markdown                                          |
|                                                                          |                                                                    |
|                                                                          | Introducci√≥n a Quarto                                              |
|                                                                          |                                                                    |
|                                                                          | R Markdown vs Quarto                                               |
|                                                                          |                                                                    |
|                                                                          | Trabajos reproducibles                                             |
+--------------------------------------------------------------------------+--------------------------------------------------------------------+

## Din√°mica del curso

Cada d√≠a combinaremos teor√≠a con ejercicios. Idealmente, el cuarto y quinto d√≠a tendremos tiempo para que cada uno trabaje con sus propios datos. Todos los apuntes y ejercicios resueltos estar√°n disponibles en el [repositorio de GitHub del curso](https://github.com/DatSciR/ciencia_datos). Si alguien tiene alguna duda o sugerencia, me puede contactar por correo electr√≥nico o publicarlo en las [discusiones del repositorio de GitHub](#0) ¬°as√≠ aprenderemos entre todos! üòâ

![El proceso de aprendizaje en R, por Allison Horst. https://allisonhorst.com/everything-else](images/e684f0da-13b1-4d00-ab25-37814e79ee1e.png){width="362"}

## Objetivos del d√≠a 1

-   Aprender conceptos b√°sicos de la programaci√≥n en R.

-   Comprender la estructura, funcionalidad y potencialidad de Git y GitHub

-   Comprender el flujo de trabajo entre Git, GitHub y RStudio

-   Aprender a trabajar colaborativamente con Git y GitHub

## Conceptos b√°sicos

-   R: lenguaje de programaci√≥n din√°mico (se interpreta el c√≥digo en el momento que se ejecuta).

    [R es un lenguaje y un entorno para la computaci√≥n estad√≠stica y gr√°fica](https://www.r-project.org/about.html)

    [Un poco de historia de R contada por Jumping Rivers](https://www.jumpingrivers.com/misc/timeline/)

-   RStudio: entorno de desarrollo integrado para programar en R. Tiene cuatro zonas diferenciadas: el editor de c√≥digo, la consola (donde se ejecuta el c√≥digo), el navegador del espacio de trabajo (con el entorno ‚Äì*environment-* y el historial de comandos) y el mix de abajo a la derecha (Archivos, Gr√°ficos, Paquetes, Ayuda).

-   Objetos: cualquier elemento almacenado con un nombre espec√≠fico. Pueden ser de muchas clases: `numeric`, `integer`, `logical`, `data.frame`, `SpatVector`, etc.

-   Funciones: objetos de R que toman un vector de entrada y dan como resultado otro vector haciendo una acci√≥n concreta (funcionalidad espec√≠fica). Son los *bloques de construcci√≥n* fundamentales en cualquier script de R que es un lenguaje funcional.

![](images/function.png)

> Para comprender la computaci√≥n en R, resultan √∫tiles dos lemas:
>
> \- Todo lo que existe es un objeto.
>
> \- Todo lo que sucede es una llamada a funci√≥n.
>
> --- John Chambers ([Advanced R](https://adv-r.hadley.nz/index.html))

-   Paquetes o librerias: contienen funciones reutilizables, documentaci√≥n sobre c√≥mo usarlas y datos de ejemplo. Son las unidades fundamentales de c√≥digo reproducible en R.

-   CRAN: the Comprehensive R Archive Network.

## Comenzando a trabajar en R

### El espacio de trabajo

El directorio de trabajo es la carpeta de nuestro ordenador donde estamos trabajando.

```{r wd}
#| eval: false

getwd() # saber directorio de trabajo 
setwd("C:/Users/veruk/Desktop/Disco/Curso Ciencia de Datos/ciencia_datos") # ojo con la ruta / o \\
```

No es recomendable establecer el directorio de trabajo manualmente porque el trabajo deja de ser reproducible. Es mejor crear desde el principio un proyecto en R ligado a un directorio relativo que contenga todos los datos de entrada, los scripts y los resultados del script. Al abrir el proyecto, se sincroniza con pesta√±a Files.

üí°Para crear un proyecto: Archivo \> Nuevo proyecto

#### Ejercicio

Crea un proyecto para el curso de de ciencia de datos

### Instalar y cargar paquetes

üí°Para ejecutar un comando: Ctrl + Enter (Ctrl + R)

```{r instalar}

# install.packages("tidyverse", dep = T) # dep = T significa instalar dependencias

library(tidyverse)

?tidyverse
?select
```

#### Ejercicio

Instala el metapaquete tidyverse utilizando la consola.

### Operaciones aritm√©ticas (R como calculadora)

```{r aritmetica}

5 + 6
5 * 6
60 / 4
5 + 4 - 2
5 + 4 * 5
(5 + 4) * 5
log(10) # logaritmo neperiano 
log10(10) 
exp(1) 
3 ^ 2 
3 ^ 2 / 3 
sqrt(16) 
pi 
sin(pi / 2) # en radianes 
cos(pi / 2)
tan(pi / 2)
asin(1) * 2
acos(1)
```

## Objetos de R

### Nombramiento de objetos

Al asignar un nombre a un objeto podemos llamarlos siempre que necesitemos a lo largo del script. No es necesario guardar (exportar) la mayor√≠a de los objetos que tenemos en el entorno de trabajo de R a nuestro ordenador, lo importante es conservar el script con el que se generan.

```{r crear_obj}
x <- 4.5 # shortcut para la flecha de asignaci√≥n Alt + "-" 
y <- "objeto" # si el objeto contiene letras, usar comillas 
class(x) # funci√≥n para ver de que clase es nuestro objeto 
class(y) 
x # Llamar al vector para saber su valor 
y
```

üìùLos nombre de los objetos deben ser descriptivos y no pueden contener s√≠mbolos especiales (`^`, `!`, `$`, `@`, `+`, `-`, `/`, `*`).

üìùR es sensible a las may√∫sculas. Mejor no usarlas.

### Tipos de objetos

#### Vectores

Un vector es la estructura de datos m√°s sencilla en R. Un vector es una colecci√≥n de uno o m√°s datos del mismo tipo.

```{r vectores}

v1 <- c(2.4, 4, 6, 3.2) # si quiero asignar mas de un valor uso "c" (concatenar) 
v1 
v1 * 100 # puedo operar con los vectores 
log(v1)
v2 <- c(1, 3, 4, 8) # pero tambi√©n entre vectores 
v1 + v2
v3 <- v1 - v2 
v3

mean(x = v2) # funciones ya programadas 
# ?mean # ayuda de funciones
sd(v2) 
length(v2) # n vector 
max(v2) 
min(v2)

# funciones que facilitan la creaci√≥n de vectores
rep(x = 1, times = 4) 
1:10 # dos puntos de a a b 
seq(from = 1, to = 20, by = 2) 
c(v1, v2) 
c(v1, rep(0, 3), v1)
```

#### Ejercicio

-   Elije un n√∫mero y multiplicalo por 3

-   Crea un objeto que contenga 100 valores entre 1900 y 2000

-   Suma un n√∫mero a tu objeto

-   Multiplica tu objeto por s√≠ mismo

-   Crea un objeto que contenga el n√∫mero 5 repetido 9 veces junto con una secuencia de 5 a 50 cada 5 elementos

-   ¬øCu√°l es la longitud del objeto anterior?

Para crear vectores se pueden usar otras estrategias como las que ten√©is recogidas a continuaci√≥n.

```{r mas_vectores}

rep(x = 1, times = 4) 
rep(1:4, times = 2) 
rep(1:4, each = 2) 
rep(1:4, times = 1:4)
rep(x = c("gato", "perro", "pez"), times = c(5, 3, 1))
rnorm(10, mean = 4, sd = 2.2)
```

#### Matrices

Las matrices pueden ser descritas como vectores multidimensionales. Al igual que un vector, √∫nicamente pueden contener datos de un s√≥lo tipo, pero adem√°s de largo, tienen m√°s dimensiones.

```{r matrices}

mivector <- sample(x = 1:10, size = 1000, replace = T) # sample: funci√≥n para crear numeros aleatorios 

mimatriz <- matrix(mivector, nrow = 100, ncol = 10) # matrix: funci√≥n para convertir vector en matriz. matrix va a rellenar por columnas por defecto

str(mivector) # mostrar estructura datos 
str(mimatriz)

summary(mivector) # resumen de los datos 
summary(mimatriz)

a <- c(1, 2, 3, 4) 
b <- c(1, 2, 3, 4) 
d <- c("hi", "hola", "hola", "hi")

mimatriz_num <- matrix(c(a, b), nrow = 4, ncol = 2) 
mimatriz_num

mimatriz_car <- matrix(c(a, b, d), nrow = 4, ncol = 3) 
mimatriz_car

summary(mimatriz_num) 
summary(mimatriz_car)
```

#### Bases de datos (data.frame)

Los data.frames son estructuras de datos de dos dimensiones (rectangulares) que pueden contener datos de diferentes tipos, por lo tanto, son heterog√©neas. Esta estructura de datos es la m√°s usada para realizar an√°lisis de datos.

```{r dataframes}

midataframe <- data.frame(
  mivariable1 = a, 
  mivariable2 = b, 
  mivariable3 = d)

View(midataframe)

# un tibble es un data.frame de tidyverse, con caracter√≠sticas mejoradas

mitibble <- tibble(
  mivariable1 = a, 
  mivariable2 = b, 
  mivariable3 = d)

str(mitibble) 
str(midataframe) 

summary(mitibble) 
summary(midataframe) 

mitibble
midataframe
```

#### Listas

Las listas, al igual que los vectores, son estructuras de datos unidimensionales, s√≥lo tienen largo, pero a diferencia de los vectores cada uno de sus elementos puede ser de diferente tipo o incluso de diferente clase, por lo que son estructuras heterog√©neas.

```{r listas}

e <- c(TRUE, TRUE, TRUE, FALSE, FALSE)

milista <- list(a, b, d, e)
milista 

str(milista) 
summary(milista)

milista2 <- list(a, b, d, e, mivector, mimatriz, midataframe)
str(milista2)
```

### Indexaci√≥n

```{r acceder}

mivector 
mivector[505]

mimatriz 
mimatriz[20, 9] # [filas, columnas] 
mimatriz[20, ] # selecciono todas las columnas de la fila 20
mimatriz[, 9] # selecciono todas las filas de la columna 9

midataframe 
midataframe[3, 3] 
midataframe[3, "mivariable3"] 
midataframe[, "mivariable3"] 
midataframe$mivariable3

milista 
milista[[4]] 
milista[[4]][4]
```

üí°Puedes leer m√°s sobre los tipos de objetos en R [aqu√≠](https://bookdown.org/jboscomendoza/r-principiantes4/estructuras-de-datos.html).

üìù Usar espacios antes y despu√©s de `=` y despu√©s de `,` hace mucho m√°s f√°cil identificar los argumentos de la funci√≥n y, en general, todos los componentes.

```{r espacios}

set.seed(123)
mean(rnorm(10, mean = 50, sd = 25) / 12, trim = 0.2)

set.seed(123)
mean(rnorm(10,mean=50,sd=25)/12,trim=0.2)

```

#### Ejercicio

-   Crea una lista que contenga dos data.frame con dos variables cada uno (variable1 y variable2) y diez observaciones por variable.

-   Accede a la octava observaci√≥n de variable2 de cada data.frame.

## Tidyverse

[*Tidyverse*](https://www.tidyverse.org/) es una colecci√≥n de paquetes (meta-paquete) de R. El n√∫cleo contiene ocho paquetes principales (`readr`, `tibble`, `dplyr`, `tidyr`, `stringr`, `forcats`, `ggplot2` y `purrr`), que comparten el dise√±o, la gram√°tica y la estructura de los datos que necesitan. En el centro de la filosof√≠a de tidyverse se encuentra la noci√≥n de ‚Äúdatos ordenados‚Äù (*tidy data*). Hadley Wickham (principal desarrollador de *tidyverse*) los define como ‚Äúf√°ciles de manipular, modelar y visualizar, y que tienen una estructura espec√≠fica: cada variable es una columna, cada observaci√≥n es una fila y cada valor es una celda‚Äù. *Tidyverse* puede considerarse un dialecto del lenguaje de programaci√≥n R que discretiza funciones amplias de R base (p. ej. `merge`) en diversas funciones espec√≠ficas (p. ej. `left_join`, `right_join`).

Los [tres principios b√°sicos](https://design.tidyverse.org/unifying.html) de este meta-paquete son:

-   Centrado en humanos: tiene un dise√±o intuitivo que facilita su uso y accesibilidad para el usuario, ya que est√° dise√±ado espec√≠ficamente para respaldar las actividades de un analista de datos humano.

-   Consistencia: todos los paquetes est√°n dise√±ados para trabajar con datos ordenados (*tidy data*), y las funciones de los paquetes tienen una nomenclatura com√∫n y congruente. Esto permite que un usuario que aprende sobre una funci√≥n o paquete pueda aplicar ese conocimiento a otros, facilitando as√≠ la tarea de recordar y deducir c√≥digo.

-   Componiblidad: permite al usuario resolver problemas complejos dividi√©ndolos en peque√±as partes, que pueden combinarse utilizando el operador *pipe*, ya sea el del paquete `magrittr` (`%>%`) o el creado recientemente en R base (`|>`).

üí°Los dos operador *pipe* tienen peque√±as [diferencias](https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/) pero en general el comportamiento es el mismo.

üí°Para m√°s informaci√≥n sobre *tidyverse* y las diferencias con R base te recomendamos leer [*Tidyverse: colecci√≥n de paquetes de R para la ciencia de datos*](https://revistaecosistemas.net/index.php/ecosistemas/article/view/2745).

```{r pipe}

length(unique(d))

d |> unique() |> length() # Ctrl + Shift + M para poner un pipe

```

En este curso realizaremos las distintas tareas que forman parte de la ciencia de datos utilizando *tidyverse*, aunque tambi√©n se podr√≠an llevar a cabo con R base. Consideramos que los cuatro pilares b√°sicos de *tidyverse* (centrado en humanos, consistencia y componibilidad) facilitan tanto el aprendizaje como el trabajo diario, permitiendo realizar las mismas acciones de manera m√°s sencilla, aunque reconocemos que esto puede variar seg√∫n la persona.

## ¬øQui√©n responde a mis dudas en R?

-   [RStudio User Guide](https://docs.posit.co/ide/user)

-   [Cheatsheet de buenas pr√°cticas en R](https://rstudio.github.io/cheatsheets/R-best-practice.pdf)

-   [Posit Recipes](https://posit.cloud/learn/recipes) y en general [Posit Resources](https://posit.co/resources)

-   Ayuda \> Cheat Sheets

-   [Stack Overflow: plataforma de preguntas y respuestas para programadores profesionales y aficionados](https://stackoverflow.com)

-   [Comunidad de RStudio/Posit](RStudio%20community)

-   [GitHub copilot](https://github.com/features/copilot)

-   [ChatGPT](https://chatgpt.com) y similares

-   Slack del [Grupo de Ecoinform√°tica de la AEET](https://ecoinfaeet.github.io/website/index.html)

-   [Discusiones del repositorio del curso de GitHub](https://github.com/DatSciR/ciencia_datos/discussions/2)

-   Para dudas relacionadas con errores de paquetes: repositorio de GitHub del paquete en cuesti√≥n (p. ej. <https://github.com/tidyverse/dplyr/issues>)

-   Pedir ayuda utilizando ejemplos reproducibles con {[reprex](#0)}.

![Por Allison Horst. https://allisonhorst.com/everything-else](images/rhelpers.png){width="538"}

## Importancia de Git y GitHub 

Git (<https://git-scm.com/>) y GitHub ([https://github.com/](#0){.uri}) est√°n ganando cada vez m√°s importancia en diversos campos de estudio a medida que el volumen de datos aumenta y los an√°lisis se hacen m√°s complejos. Aprenderemos c√≥mo Git puede usarse para controlar la trazabilidad de los cambios realizados en proyectos o archivos y veremos c√≥mo este control de versiones es especialmente √∫til en proyectos colaborativos mediante el uso de un servidor de alojamiento en l√≠nea como GitHub.

Aunque existen multitud de manuales disponibles gratuitamente sobre c√≥mo utilizar Git y GitHub, estas herramientas son complejas. El prop√≥sito original de Git era ayudar a grupos de desarrolladores inform√°ticos a trabajar en colaboraci√≥n en grandes proyectos de software, por lo que puede resultar enrevesado, hay m√∫ltiples soluciones para el mismo problema y tiene una curva de aprendizaje pronunciada. Sin embargo, Git y GitHub nos pueden ayudar a solucionar algunos problemas comunes derivados de la creaci√≥n de diferentes versiones que pueden ser un poco molestos:

\- Sobreescritura de un archivo

\- Versiones finales infinitas

![](images/FINALdoc.png)

\- Trabajo por error en una versi√≥n que no era la final

\- Creaci√≥n de copias "en conflicto" cuando dos personas trabajan a la vez

\- Ediciones sin control de cambios

![Ediciones sin control de cambios](images/tracker.png){alt="Ediciones sin control de cambios"}

### Qu√© es Git

Git es un sistema avanzado de control de versiones (como el "control de cambios" de Microsoft Word) distribuido [@blischak2016; @ram2013]. Git permite "rastrear" el progreso de un proyecto a lo largo del tiempo ya que hace "capturas" del mismo a medida que evoluciona y los cambios se van registrando. Este sistema permite ver qu√© cambios se hicieron, qui√©n los hizo y por qu√©, e incluso volver a versiones anteriores. Adem√°s, Git facilita el trabajo en paralelo de varios participantes. Mientras que en otros sistemas de control de versiones (p. ej. Subversion (SVN, <https://subversion.apache.org/>) o Concurrent Versions System (CVS, <http://cvs.nongnu.org/>)) hay un servidor central y cualquier cambio hecho por un usuario se sincroniza con este servidor y de ah√≠ con el resto de usuarios, Git es un control de versiones distribuido que permite a todos los usuarios trabajar en el proyecto paralelamente e ir haciendo "capturas" del trabajo de cada uno para luego unirlos. Otras alternativas de control de versiones distribuido comparables a Git son Mercurial (<https://www.mercurial-scm.org/>) o Bazaar (<https://bazaar.canonical.com/>), pero Git es con diferencia el m√°s utilizado.

![Ejemplo de un proyecto rastreado por Git con indicaciones de c√≥mo se registran los cambios y la evoluci√≥n del proyecto, el autor o autora de los cambios (¬øqui√©n?), el momento en que se han registrado (¬øcu√°ndo?), en qu√© documentos o l√≠neas se han producido cambios (¬ød√≥nde?) y qu√© ha cambiado (¬øqu√©?)](images/git.jpg){alt="Ejemplo de un proyecto rastreado por Git con indicaciones de c√≥mo se registran los cambios y la evoluci√≥n del proyecto, el autor o autora de los cambios (¬øqui√©n?), el momento en que se han registrado (¬øcu√°ndo?), en qu√© documentos o l√≠neas se han producido cambios (¬ød√≥nde?) y qu√© ha cambiado (¬øqu√©?)"}

### Qu√© es GitHub

GitHub es un servidor de alojamiento en l√≠nea o repositorio remoto para albergar proyectos basados en Git que permite la colaboraci√≥n entre diferentes usuarios o con uno mismo [@galeano2018; @perez-riverol2016]. Un repositorio es un directorio donde desarrollar un proyecto que contiene todos los archivos necesarios para el mismo. Aunque existen distintos repositorios remotos (p. ej. GitLab, <https://gitlab.com/>, o Bitbucket, <https://bitbucket.org/>) con funcionalidad similar, GitHub es hoy en d√≠a el m√°s utilizado. GitHub registra el desarrollo de los proyectos de manera remota, permite compartir proyectos entre distintos usuarios y proporciona la seguridad de la nube entre otras funciones. Cuando se trabaja en proyectos colaborativos, la base de la interacci√≥n entre Git y GitHub es que todos los colaboradores de un proyecto est√°n de acuerdo en que GitHub contiene la copia principal del proyecto, es decir, GitHub contiene la copia centralizada del control de versiones distribuido o descentralizado.

![P√°gina inicial de GitHub](images/github_pag_ini.JPG){alt="P√°gina inicial de GitHub"}

![Interacci√≥n entre Git y GitHub. Git, al ser un control de versiones distribuido, permite que todos los usuarios trabajen paralelamente sin interferir en el trabajo de los dem√°s. Luego cada usuario sincroniza su trabajo con la copia principal del proyecto ubicado en GitHub](images/conexiones.jpg){alt="Interacci√≥n entre Git y GitHub. Git, al ser un control de versiones distribuido, permite que todos los usuarios trabajen paralelamente sin interferir en el trabajo de los dem√°s. Luego cada usuario sincroniza su trabajo con la copia principal del proyecto ubicado en GitHub" fig-align="center"}

## Instalaci√≥n

En este punto es necesario que tengas instalada la versi√≥n m√°s reciente de R (<https://cloud.r-project.org/>), RStudio (<https://posit.co/download/rstudio-desktop/>), Git (<https://happygitwithr.com/install-git.html>) y una cuenta en GitHub (<https://github.com/>) creada.

### Ejercicio

1.  En el *shell*, pres√©ntate a Git ([Chapter 7: Git-Intro](https://happygitwithr.com/hello-git.html))

    *Tools* -\> *Terminal*

    `git config --global user.name 'Nombre Apellido'`

    `git config --global user.email 'nombre@ejemplo.com'`

    üí°**Este debe ser el correo electr√≥nico asociado a tu cuenta de GitHub**

    ```{r config}
    #|eval: false  

    # Tambi√©n puedes hacerlo utilizando el paquete usethis 
    # install.packages("usethis") 
    # library(usethis) 
    # use_git_config(user.name = "Monchi", user.email = "monchi@example.org")
    ```

![Terminal](images/terminal.png){alt="Terminal"}

2.  Compueba que has instalado Git correctamente:

    `git --version`

    Para ver el usuario utilizado para configurar Git:

    `git config user.name`

    Para ver a qu√© cuenta de correo est√° asociado Git:

    `git config user.email`

    Para ver tanto el usuario como el correo asociado:

    `git config --global --list`

Para la resoluci√≥n de problemas durante la instalaci√≥n recomendamos mirar aqu√≠: <https://happygitwithr.com/troubleshooting.html>

3.  Genera un PAT (*Personal Access Token*) para HTTPS

    Git puede comunicarse con un servidor remoto utilizando uno de los dos protocolos: HTTPS o SSH. Nosotros utilizaremos HTTPS con *personal access token* (PAT, <https://happygitwithr.com/https-pat.html>).

```{r token} #|eval: false  # install.packages("usethis") # install.packages("gitcreds") # library(usethis) # library(gitcreds) # create_github_token() # generar un token # gitcreds_set() # acceder al Git credential store}
```

üí°Conviene describir el prop√≥sito del token en el campo *Note*, porque se pueden tener varios PATs. No podr√°s volver a ver este token, as√≠ que no cierres ni salgas de la ventana del navegador hasta que almacenes el PAT localmente. ¬°Trata este PAT como una contrase√±a!

## Repositorios y proyectos

Un repositorio es como un "contenedor" donde desarrollar un proyecto.

Para crear un repositorio en GitHub damos a "*+ New repository*". Aqu√≠ se indica el nombre, una peque√±a descripci√≥n, y si quieres que sea p√∫blico o privado. Se recomienda iniciar el repositorio con un archivo "README" (*Initialize this repository with a README*) para recoger cualquier informaci√≥n esencial para el uso del repositorio (estructura, descripci√≥n m√°s detallada del contenido, etc.).

En RStudio, creamos un nuevo proyecto y lo conectamos al repositorio: File \> New project \> Version control \> Git \> copiar el URL del repositorio que hemos creado de GitHub (est√° en la p√°gina principal de nuestro repositorio, en "*clone or download*"). Seleccionamos el directorio local donde queremos guardar el proyecto y pulsamos en "*Create project*".

Si vamos al directorio local seleccionado, encontraremos la carpeta conectada a Git y GitHub que hemos creado en nuestro ordenador. Podemos copiar aqu√≠ todos los archivos que nos interesan para el proyecto (datos, im√°genes, etc).

üí°Para m√°s informaci√≥n sobre c√≥mo clonar el repositorio en GitHub (repositorio remoto) en nuestro ordenador (repositorio local) ver <https://happygitwithr.com/rstudio-git-github.html> para hacerlo desde RStudio y @galeano2018 para hacerlo mediante la l√≠nea de comandos.

üí°En caso de querer conectar un antiguo proyecto de RStudio a Git y GitHub, puedes seguir los pasos que se describen aqu√≠: <https://happygitwithr.com/existing-github-first.html>.

### Estructura del repositorio de GitHub

En la p√°gina principal del repositorio en GitHub podemos encontrar las siguientes pesta√±as:

-   **Code**: contenido del proyecto

-   **Issues**: foro del proyecto para comentar fallos, tareas pendientes, hacer peticiones a los desarrolladores, preguntar dudas, etc. Se pueden asignar tareas o preguntas a los miembros del proyecto escribiendo "\@" antes del nombre del colaborador. Una vez resuelto, el issue se cierra (*Close issue*).

-   **Pull requests**: veremos m√°s adelante para qu√© sirve.

-   **Actions**: son peque√±as aplicaciones que realizan alguna acci√≥n cada vez que se sube un commit (p. ej. tests).

-   **Projects**: es como una hoja de c√°lculo con tareas, encargados, deadlines, status, etc. que se integra con las incidencias y solicitudes de incorporaci√≥n de cambios para ayudar a planificar las tareas y realizar el seguimiento del trabajo.

-   **Wiki**: es un espacio para documentar el proyecto (hoja de ruta, estado, documentaci√≥n detallada...).

-   **Security**: opciones de seguridad.

-   **Insights**: estad√≠sticas del proyecto.

-   **Settings**

![Repositorio en GitHub destacando algunas pesta√±as importantes](images/github_repositorio.JPG){alt="Repositorio en GitHub destacando algunas pesta√±as importantes"}

#### Ejercicio

1.  Crea un repositorio en GitHub y con√©ctalo a un nuevo proyecto de RStudio (esto generar√° un repositorio (carpeta) en tu ordenador en la ubicaci√≥n que hayas especificado). Incluir un archivo "*.gitignore"*

2.  Crea un nuevo script de R en el directorio de trabajo (es decir, crea un script de R y gu√°rdalo dentro del repositorio que has creado)

3.  En RStudio ve a la pesta√±a Git para ver todos los documentos que han sido identificados por Git

Una vez finalizada la instalaci√≥n podr√°s ver la pesta√±a de Git en RStudio.

![Git en RStudio](images/RStudio.JPG){alt="Git en RStudio"}

### Git ignore

Al crear un repositorio se recomienda crear un archivo "*.gitignore*". Este archivo contendr√° los nombres o extensiones de los archivos del proyecto que por defecto no queremos compartir aunque est√©n en el repositorio local (p. ej., el archivo "*.Rhistory*" que RStudio crea por defecto). Es una buena pr√°ctica ignorar archivos que no sean √∫tiles para el resto de colaboradores as√≠ como archivos muy pesados (p. ej., una base de datos resultado de correr un script) para no subirlos y descargarlos continuamente de GitHub. Para a√±adir archivos al *gitignore* se puede utilizar el bot√≥n derecho del rat√≥n sobre el archivo en la pesta√±a Git de RStudio pero tambi√©n se puede a√±adir el nombre del archivo que desamos ignorar en el archivo "*.gitignore*" manualmente.

### GitHub: la red social

GitHub no es s√≥lo un repositorio remoto donde almacenar diferentes versiones de tu trabajo o desarrollar proyectos colaborativos, si no que tambi√©n es una red de encuentro para programadores. Como en otras redes puedes cotillear perfiles, seguir a ciertas personas, tener seguidores, guardar proyectos que te gustan‚Ä¶

Con el buscador (üîç) puedes buscar aquellos contenidos que te interesan. La b√∫squeda est√° organizada por categor√≠as (*Repositories, Commits, Issues, Users*‚Ä¶) lo que facilita encontrar lo que buscas. Para seguir a un usuario tienes la opci√≥n *Follow*. Pulsando *Star*‚≠ê puedes guardar un enlace a cualquier repositorio en tu cuenta de GitHub y con *Fork* estar√≠as guardando una copia con la que puedes interaccionar. Con *Watch*üëÅÔ∏è puedes hacer un seguimiento de un repositorio. *Download* te permite guardar una copia de cualquier repositorio p√∫blico en tu ordenador.

## Flujo de trabajo en Git y GitHub

Git es capaz de rastrear todos los archivos contenidos en un repositorio. Para comprender c√≥mo Git registra los cambios y c√≥mo podemos compartir dichos cambios con nuestros colaboradores es importante entender c√≥mo se estructura Git y c√≥mo se sincroniza con GitHub. Hay cuatro "zonas" de trabajo:

1.  **Directorio de trabajo (*working directory*):** es donde se est√° trabajando. Esta zona se sincroniza con los archivos locales del ordenador.

2.  **√Årea de preparaci√≥n (*staging area* o *Index*):** es la zona intermedia entre el directorio de trabajo y el repositorio local de Git. Es la zona de borradores. El usuario debe seleccionar los archivos que se van a registrar en la siguiente "captura" de Git.

3.  **Repositorio local (*local repository* o *HEAD*):** es donde se registran todos los cambios capturados por Git en tu ordenador.

4.  **Repositorio remoto (*remote repository*):** es donde se registran todos los cambios capturados por Git en la nube (GitHub).

![Representaci√≥n gr√°fica de las diferentes zonas de trabajo en Git y GitHub: directorio de trabajo, √°rea de preparaci√≥n o Index, repositorio local o HEAD, y repositorio remoto. Imagen de fondo de Philip Brookes (https://creativecommons.org/licenses/by-nc-nd/2.0/legalcode)](images/arboles.jpg){alt="Representaci√≥n gr√°fica de las diferentes zonas de trabajo en Git y GitHub: directorio de trabajo, √°rea de preparaci√≥n o Index, repositorio local o HEAD, y repositorio remoto. Imagen de fondo de Philip Brookes (https://creativecommons.org/licenses/by-nc-nd/2.0/legalcode)" fig-align="center" width="569"}

### ¬øC√≥mo moverse de una zona a otra?

Se puede hacer mediante l√≠nea de comandos en la terminal y tambi√©n mediante la pesta√±a integrada en RStudio, pero el proceso es el mismo.

Al principio todos los cambios realizados aparecen en amarillo porque Git no sabe que hacer con ellos. Estamos en el directorio de trabajo y puede que no nos interese guardar todos los cambios para el futuro.

Para a√±adir un cambio del directorio de trabajo al √°rea de preparaci√≥n hay que utilizar `git add` (en la pesta√±a Git de RStudio se hace seleccionando el archivo). Este comando indica a Git que se quieren incluir las actualizaciones de alg√∫n archivo en la pr√≥xima "captura" del proyecto y que Git las registre. Sin embargo, `git add` no afecta al repositorio local.

Para registrar los cambios que nos interesen hay que utilizar `git commit` (en la pesta√±a Git de RStudio se hace clickando el bot√≥n "*Commit*"). Al ejecutar `git commit` se hace una "captura" del estado del proyecto. Junto con el *commit* se a√±ade un mensaje con una peque√±a explicaci√≥n de los cambios realizados y por qu√© (p. ej. "incluyo las referencias formateadas"). Cada `git commit` tiene un SHA (*Secure Hash Algorithm*) que es un c√≥digo alfanum√©rico que identifica inequ√≠vocamente ese *commit* (p. ej. 1d21fc3c33cxxc4aeb7823400b9c7c6bc2802be1). Con el SHA siempre se pueden ver los cambios que se hicieron en ese *commit* y volver a esa versi√≥n f√°cilmente.

Por √∫ltimo, `git push` permite subir los cambios que hemos hecho a GitHub y quedar√°n visibles para nuestros colaboradores (en la pesta√±a Git de RStudio se hace clickando el bot√≥n "*Push*"). B√°sicamente, `git commit` registra los cambios en el repositorio local y `git push` actualiza el repositorio remoto con los cambios y archivos asociados.

Cuando se retoma un proyecto tras horas, d√≠as o incluso meses, con `git pull` se descargan todas las actualizaciones que haya en GitHub (nuestras o de nuestros colaboradores), que se fusionar√°n (*merge*) con el √∫ltimo *commit* en nuestro repositorio local (en la pesta√±a Git de RStudio se hace clickando el bot√≥n "*Pull*").

![Flujo de trabajo en Git y GitHub mostrando las diferentes zonas de trabajo y los comandos utilizados para la transici√≥n de una zona de trabajo a otra.](images/workflow_git_github.jpg){alt="Flujo de trabajo en Git y GitHub mostrando las diferentes zonas de trabajo y los comandos utilizados para la transici√≥n de una zona de trabajo a otra."}

![Opciones de Git en RStudio](images/git_RStudio.png){alt="Opciones de Git en RStudio" fig-align="center" width="486"}

![Commit en RStudio](images/commit_RStudio.png){alt="Commit en RStudio" fig-align="center" width="545"}

Adem√°s, en la pesta√±a Git de RStudio podemos observar el bot√≥n "*Diff*" que muestra los cambios que se han hecho a cada archivo desde el √∫ltimo commit y las ramas (que lo explicaremos m√°s abajo). Clickando con el bot√≥n derecho del rat√≥n podemos abrir los archivos que han sido modificados mediante "*Open file*" y con el bot√≥n "*Revert*" volvemos al estado del √∫ltimo commit (‚ö†Ô∏ècuidado con esto porque te borrar√° los cambios realizados en tu directorio de trabajo).

#### Ejercicio

En el proyecto generado en el ejercicio anterior, guardad y subid los cambios realizados a GitHub (`git add` + `git commit` + `git push`)

üí°`git status`: muestra la rama en la que estamos y los cambios hechos y a√±adidos desde el √∫ltimo commit.

üí°Usar `git commit` es para el proyecto como usar anclajes cuando estamos escalando una pared de roca. Desarrollar un script sin commits es como escalar sin asegurarse: puedes avanzar mucho m√°s r√°pido a corto plazo, pero a largo plazo las probabilidades de fallo catastr√≥fico son altas. Por otro lado, hacer muchos commits va a ralentizar tu progreso. Lo mejor: usar m√°s commits cuando est√°s en un territorio incierto o peligroso.

![Lineas de trabajo (cuerdas) aseguradas con varios commits (anclajes)](images/climbing.png){alt="Lineas de trabajo (cuerdas) aseguradas con varios commits (anclajes)"}

En el repositorio remoto de GitHub, en la pesta√±a *Code* podemos observar el contenido de nuestro proyecto, incluyendo cada *commit* realizado:

![Repositorio en GitHub destacando informaci√≥n importante](images/github_repositorio2.JPG){alt="Repositorio en GitHub destacando informaci√≥n importante"}

### Navegar por el historial

El historial de un repositorio (*üïòXX commits*) contiene una lista de enlaces a todos los commits que se han realizado en cualquiera de las ramas. Dentro de cada *commit* se pueden ver los archivos a√±adidos o borrados en esa "captura" y las l√≠neas de c√≥digo a√±adidas (en verde) o borradas (en rojo) en cada archivo modificado. Adem√°s, en el historial, se pueden a√±adir comentarios en l√≠neas concretas de c√≥digo o comentarios generales al *commit* entero.

En GitHub tambi√©n se puede acceder a la historia de commits de cada archivo en concreto (*History*) y al autor de cada parte del c√≥digo (*Blame*).

El historial del proyecto y de los archivos tambi√©n es accesible a trav√©s de RStudio (üïí).

üí°M√°s informaci√≥n sobre como navegar en el pasado del proyecto aqu√≠: <https://happygitwithr.com/time-travel-see-past.html>

![Historial de un repositorio](images/hist.jpg){alt="Historial de un repositorio"}

üí°En los *issues* se puede referenciar a una l√≠nea concreta de c√≥digo de un estado concreto del proyecto entrando en el archivo en la pesta√±a *Code* y clickando en el n√∫mero de l√≠nea que se quiere comentar, o a un *commit* entero copiando el SHA.

üí°Si quiero volver atr√°s en el tiempo o si hago un cambio que no quiero ¬øc√≥mo lo puedo resolver? Hay m√∫ltiples opciones pero [aqu√≠](https://github.com/DatSciR/intro_git-github/blob/main/centra/dia3_comandos.md)(en la secci√≥n de "La he liado ¬øc√≥mo deshago los cambios?") detallamos tres: *restore*, *reset* y *revert*.

## Trabajo colaborativo

Aunque Git y GitHub facilitan el control de versiones de nuestros proyectos individuales, su m√°xima potencialidad se despliega al trabajar en equipo ya que facilitan el seguimiento del trabajo de todos los colaboradores y la integraci√≥n ordenada de cada parte en un producto final.

Para dar acceso de edici√≥n a tus colaboradores, en la p√°gina principal de nuestro proyecto en GitHub entramos en "*Settings -\> Access -\> Collaborators -\> Manage Access -\> Add people*". Los colaboradores pueden crear su copia local del proyecto de control de versiones clonando el repositorio remoto.

#### Ejercicio

En equipos de 2 o 3 personas:

1.  El due√±o del repositorio invita al resto de integrantes del equipo a su proyecto
2.  Los colaboradores clonan el repositorio al que han sido invitados a su directorio de trabajo

### Ramificaci√≥n

Git permite crear una "rama" (*branch*) paralela al proyecto si se desea seguir una l√≠nea independiente de trabajo, bien por ser diferente de la principal (p. ej. probar un nuevo an√°lisis) o bien para desarrollar espec√≠ficamente una parte del proyecto (p. ej. trabajar s√≥lo en la escritura de los m√©todos de un art√≠culo mientras otros colaboradores trabajan en otras secciones). Las ramas permiten trabajar en el proyecto sin interferir con lo que est√°n haciendo los compa√±eros. En Git, una rama es un *commit* al que le se le da un nombre y que contiene un "enlace" (puntero o *pointer*) a un SHA espec√≠fico que es el origen de la rama. La rama *main* es la rama por defecto cuando se crea un repositorio y a partir de ella se suelen crear las dem√°s.

Las ramas se pueden generar en la [terminal](https://github.com/DatSciR/intro_git-github/blob/main/centra/dia2_colaboracion.md) y en la pesta√±a Git de RStudio. En la pesta√±a Git se generan mediante el bot√≥n "*New Branch*". Al lado de "*New Branch"* podemos observar todas las ramas que contiene el repositorio y nos permite cambiar de rama f√°cilmente clickando en ellas.

![Proceso de creaci√≥n de la rama PPP y la rama monchi](images/ramas.png){alt="Proceso de creaci√≥n de la rama PPP y la rama monchi" fig-align="center"}

#### Ejercicio

1.  Un integrante del equipo crea una rama en el proyecto en el que colabora

2.  Modifica la primera frase del archivo README.txt y sube los cambios al repositorio remoto

3.  Vuelve a la rama main y comprueba el archivo README.txt

![](images/github_code.png){fig-align="center" width="543"}

### ¬øC√≥mo se unen distintas ramas?

Cuando el trabajo desarrollado en una rama se da por finalizado hay que hacer la uni√≥n a la rama principal ("*main*"). Esto se puede hacer en la [terminal](https://github.com/DatSciR/intro_git-github/blob/main/centra/dia2_colaboracion.md) y con el bot√≥n "*pull request*" en la p√°gina del proyecto en GitHub siguiendo los pasos que se explican a continuaci√≥n.

![Proceso de creaci√≥n y uni√≥n de ramas. Ejemplo de uni√≥n (merge) de la rama monchi a la rama main](images/merge.jpg){alt="Proceso de creaci√≥n y uni√≥n de ramas. Ejemplo de uni√≥n (merge) de la rama monchi a la rama main"}

Una vez que hemos realizado los cambios que quer√≠amos en la rama y est√°n subidos a GitHub (`git add` + `git commit` + `git push`), en GitHub aparece la opci√≥n de "Compare & pull request". Aqu√≠ se genera el *pull request* ("*Create pull request*") a√±adiendo un mensaje para saber lo que se est√° uniendo. GitHub os indicar√° si existen conflictos o no. Si no existen conflictos, podr√©is realizar el *pull request* sin problema y, si existen conflictos, hay que resolverlos manualmente.

![](images/pullrequest1.jpg){fig-align="center"}

![](images/pullrequest1.1.jpg)

![Caracter√≠sticas del merge a realizar](images/pullrequest2.jpg){alt="Caracter√≠sticas del merge a realizar" fig-align="center"}

![](images/pullrequest3.jpg){fig-align="center"}

![Confirmacion y fin del proceso](images/pullrequest3.1.jpg){alt="Confirmacion y fin del proceso" fig-align="center"}

### Resoluci√≥n de conflictos

Git puede encontrar conflictos al fusionar ramas que hay que arreglar manualmente (GitHub os indicar√° "Can't automatically merge"). Esto ocurrir√° si en las dos ramas se han cambiado las mismas l√≠neas de un archivo. Hay que generar el pull request y "*Resolve conflicts*".

![Aparici√≥n de conflictos](images/cant_merge.png){alt="Aparici√≥n de conflictos"}

![Resoluci√≥n de conflictos](images/cant_merge2.png){alt="Resoluci√≥n de conflictos"}

Git muestra d√≥nde est√°n los conflictos as√≠:

`<<<<<<c√≥digo del main=======c√≥digo de la rama a unir>>>>>>`

![](images/cant_merge3.png)

Para solucionarlo hay que escoger los cambios de la rama principal o de la rama a unir seg√∫n corresponda. Una vez solucionados, Git permite completar el *merge* (es decir, un nuevo *commit* que contendr√° las ramas fusionadas). La mejor manera de evitar conflictos o por lo menos reducir su dificultad es realizar cambios peque√±os y sincronizar frecuentemente con GitHub, y tener una comunicaci√≥n fluida con los colaboradores.

#### Ejercicio

1.  Un integrante del equipo modifica tambi√©n la primera frase del archivo README.txt en la rama main y sube los cambios al repositorio remoto. Esta frase hab√≠a sido previamente modificada en una rama en el ejercicio anterior.
2.  Un integrante del equipo combina la rama del ejercicio anterior con la rama principal (*main*) del proyecto.
3.  Resolved el conflicto (es decir, quedaos con los cambios que sirvan y subid los cambios al repositorio remoto).

üí°[Aqu√≠](https://github.com/DatSciR/intro_git-github/blob/main/centra/dia3_comandos.md) (en la secci√≥n de "Otros comandos √∫tiles") pod√©is ver c√≥mo borrar ramas y otros comandos √∫tiles

## Enlaces de inter√©s

**Ciencia reproducible**

-   [Ciencia reproducible: qu√©, por qu√©, c√≥mo](https://github.com/ecoinfAEET/Reproducibilidad)

**Control de versiones (Git)**

-   [Manual de referencia de Git](https://git-scm.com/docs)

-   [Software Carpentry](http://swcarpentry.github.io/git-novice/)

-   [Atlassian Bitbucket](https://www.atlassian.com/git/tutorials)

-   [Oh Shit, Git!?!](https://ohshitgit.com/)

-   [git - la gu√≠a sencilla](https://rogerdudler.github.io/git-guide/index.es.html)

-   [Pro Git](https://git-scm.com/book/es/v2)

**Integrar Git, GitHub y RStudio**

-   [Happy Git and GitHub for the useR](https://happygitwithr.com/)

-   [¬°Se puede entender c√≥mo funcionan Git y GitHub!](https://www.revistaecosistemas.net/index.php/ecosistemas/article/view/2332)

-   [Ciencia reproducible y colaborativa con R, Git y GitHub (DatSciR)](https://github.com/DatSciR/intro_git-github)

**Ense√±ar y aprender con GitHub**

-   [GitHub Education para profesores e investigadores](https://docs.github.com/en/education/explore-the-benefits-of-teaching-and-learning-with-github-education/use-github-in-your-classroom-and-research/about-github-education-for-educators-and-researchers)

------------------------------------------------------------------------

<details>

<summary>Session Info</summary>

```{r session_info}
Sys.time()
sessionInfo()
```

</details>
